<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>jsMind V2 Playground</title>
    <link rel="stylesheet" href="../styles/jsmind.css">
    <style type="text/css">
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            padding: 12px 20px;
            background: #2d3748;
            color: white;
            border-bottom: 1px solid #4a5568;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 600;
        }

        .container {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            overflow: hidden;
            min-height: 0;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e2e8f0;
            background: #f7fafc;
            min-height: 0;
            overflow: hidden;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
            background: white;
            min-height: 0;
            overflow: hidden;
        }

        .panel-header {
            padding: 10px 16px;
            background: #edf2f7;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
            font-size: 14px;
            color: #2d3748;
            flex-shrink: 0;
        }

        .mindmap-container {
            flex: 1 1 0;
            padding: 20px;
            overflow: auto;
            background: white;
            min-height: 0;
        }

        .node-info-bar {
            flex: 0 0 auto;
            padding: 8px 16px;
            background: #edf2f7;
            border-top: 1px solid #e2e8f0;
            font-size: 12px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            color: #2d3748;
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .node-info-item {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .node-info-label {
            font-weight: 600;
            color: #4a5568;
        }

        .node-info-value {
            color: #2d3748;
            padding: 2px 8px;
            background: white;
            border: 1px solid #cbd5e0;
            border-radius: 3px;
        }

        .copy-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            margin-left: 0;
            cursor: pointer;
            color: #718096;
            font-size: 12px;
            transition: color 0.2s;
            user-select: none;
            opacity: 0.7;
        }

        .copy-icon:hover {
            color: #4299e1;
            opacity: 1;
        }

        .copy-icon:active {
            color: #2c5282;
        }

        .copy-icon.hidden {
            display: none;
        }

        .console-container {
            flex: 0 0 30%;
            display: flex;
            flex-direction: column;
            border-top: 1px solid #e2e8f0;
            background: white;
            min-height: 0;
            overflow: hidden;
            flex-shrink: 0;
        }

        .console-output {
            flex: 1 1 auto;
            overflow: auto;
            padding: 12px;
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
            min-height: 0;
        }

        .console-toolbar {
            padding: 6px 12px;
            background: #edf2f7;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 8px;
            align-items: center;
            flex-shrink: 0;
        }

        .console-line {
            margin: 2px 0;
        }

        .console-line.log {
            color: #d4d4d4;
        }

        .console-line.info {
            color: #4fc3f7;
        }

        .console-line.warn {
            color: #ffb74d;
        }

        .console-line.error {
            color: #ef5350;
        }

        .console-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-display {
            padding: 12px;
            margin: 0;
            overflow: auto;
            width: 100%;
            height: 100%;
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
            box-sizing: border-box;
        }

        .code-textarea {
            width: 100%;
            height: 100%;
            padding: 12px;
            font-family: monospace;
            font-size: 14px;
            border: none;
            resize: none;
            background: #1e1e1e;
            color: #d4d4d4;
            box-sizing: border-box;
        }

        #jsmind_container {
            width: 100%;
            height: 100%;
            min-height: 400px;
            border: 1px solid #e2e8f0;
            background: #fafafa;
            border-radius: 4px;
        }

        .code-templates-bar {
            padding: 8px 12px;
            background: #f7fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .template-label {
            font-size: 12px;
            color: #718096;
            font-weight: 500;
        }

        .template-link {
            font-size: 12px;
            color: #4299e1;
            text-decoration: none;
            padding: 2px 6px;
            border-radius: 3px;
            transition: background-color 0.2s, color 0.2s;
        }

        .template-link:hover {
            background-color: #ebf8ff;
            color: #2c5282;
        }

        .code-section {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-bottom: 1px solid #e2e8f0;
            min-height: 0;
        }

        .code-section:first-child {
            flex: 0 0 35%;
            min-height: 0;
        }

        .code-section:last-child {
            flex: 1 1 auto;
            min-height: 0;
            border-bottom: none;
            display: flex;
            flex-direction: column;
        }

        .code-editor-wrapper {
            flex: 1 1 auto;
            overflow: auto;
            position: relative;
            min-height: 0;
        }

        .code-editor {
            width: 100%;
            height: 100%;
            min-height: 0;
            display: flex;
            flex-direction: column;
        }

        .editor-toolbar {
            padding: 8px 16px;
            background: #f7fafc;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 8px;
            align-items: center;
            flex-shrink: 0;
        }

        .btn {
            padding: 6px 12px;
            background: #4299e1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #3182ce;
        }

        .btn:active {
            background: #2c5282;
        }

        .btn-secondary {
            background: #718096;
        }

        .btn-secondary:hover {
            background: #4a5568;
        }

        /* Code editor styles */
        #init-code-editor pre,
        #code-editor textarea {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>jsMind V2 Playground</h1>
    </div>

    <div class="container">
        <!-- Left: Mind Map -->
        <div class="left-panel">
            <div class="panel-header">Mind Map</div>
            <div class="mindmap-container">
                <div id="jsmind_container"></div>
            </div>
            <!-- Node Info Bar -->
            <div id="node-info-bar" class="node-info-bar">
                <div class="node-info-item">
                    <span class="node-info-label">Node ID:</span>
                    <span id="node-id-value" class="node-info-value">-</span>
                    <span class="copy-icon hidden" id="copy-node-id-icon" data-action="copy-node-id" title="Copy Node ID">ðŸ“‹</span>
                </div>
                <div class="node-info-item">
                    <span class="node-info-label">Node Content:</span>
                    <span id="content-value" class="node-info-value">-</span>
                </div>
            </div>
            <!-- Console Output Area -->
            <div class="console-container">
                <div class="panel-header console-header">
                    <span>Console Output</span>
                    <button class="btn" style="padding: 4px 8px; font-size: 11px;" data-action="clear-console">Clear</button>
                </div>
                <div id="console-output" class="console-output"></div>
            </div>
        </div>

        <!-- Right: Code Area -->
        <div class="right-panel">
            <!-- Top: Initialization Code (Read-only) -->
            <div class="code-section">
                <div class="panel-header">Initialization Code (Read-only)</div>
                <div class="code-editor-wrapper">
                    <div id="init-code-editor" class="code-editor"></div>
                </div>
            </div>

            <!-- Bottom: Editable Code Editor -->
            <div class="code-section">
                <div class="panel-header">Code Editor</div>
                <div class="code-templates-bar">
                    <span class="template-label">Templates:</span>
                    <a href="#" class="template-link" data-template="addNode">Add Node</a>
                    <a href="#" class="template-link" data-template="deleteNode">Delete Node</a>
                    <a href="#" class="template-link" data-template="updateNode">Update Node</a>
                    <a href="#" class="template-link" data-template="moveNode">Move Node</a>
                    <a href="#" class="template-link" data-template="findNode">Find Node</a>
                </div>
                <div class="code-editor-wrapper">
                    <div id="code-editor" class="code-editor"></div>
                </div>
                <div class="editor-toolbar">
                    <button class="btn" data-action="execute-code">â–¶ Execute Code</button>
                    <button class="btn btn-secondary" data-action="reset-mindmap">Reset Mind Map</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load jsMind (UMD format, will be mounted to window.jsMind) -->
    <script type="text/javascript" src="../dist/jsmind.js"></script>

    <!-- Use simple textarea as code editor -->
    <script type="text/javascript">
        /**
         * jsMind V2 Playground Application
         * Structured and modular code organization
         */
        (function() {
            'use strict';

            // ============================================================================
            // Configuration
            // ============================================================================
            const CONFIG = {
                MAX_CONSOLE_LINES: 1000,
                JSMIND_CHECK_INTERVAL: 100,
                NODE_CLICK_LISTENER_DELAY: 100,
                COPY_FEEDBACK_DURATION: 1000
            };

            // Initialization code (read-only)
            const INIT_CODE = `// Create jsMind instance
const jm = await jsMind.create('jsmind_container');

// Create mind map
const mind = new jsMind.Mind();

// Add two child nodes
mind.addChildNode('Node 1', mind.root.id);
mind.addChildNode('Node 2', mind.root.id);

// Open mind map
await jm.open(mind);`;

            const INIT_WINDOW_VARIABLES = `window.jm = jm; window.mind = mind;`;

            // Default user code
            const DEFAULT_USER_CODE = `// Write your code here
// You can use the following global variables:
// - jm: jsMind instance
// - mind: mind map instance
// - jsMind: jsMind namespace

// Example: Add a new node
if (mind && mind.root) {
    const newNode = mind.addNode(
        {'type': 'text', 'value': 'New Node ' + new Date().toLocaleTimeString()},
        { parentId: mind.root.id }
    );
    console.log('Added node:', newNode);
}`;

            // ============================================================================
            // Code Templates
            // ============================================================================
            const CODE_TEMPLATES = {
            addNode: `// Add a new node as a child of root
if (mind && mind.root) {
    const newNode = mind.addChildNode('New Node', mind.root.id);
    console.log('Added node:', newNode.id);
    // Refresh the mind map view
    await jm.open(mind);
}`,
            deleteNode: `// Delete a node by ID
// Replace 'node-id-here' with the actual node ID
const nodeId = 'node-id-here';
if (mind) {
    try {
        mind.removeNode(nodeId);
        console.log('Removed node:', nodeId);
        // Refresh the mind map view
        await jm.open(mind);
    } catch (error) {
        console.error('Failed to remove node:', error);
    }
}`,
            updateNode: `// Update node content
// Replace 'node-id-here' with the actual node ID
const nodeId = 'node-id-here';
if (mind) {
    const node = mind.findNodeById(nodeId);
    if (node) {
        node.content.value = 'Updated Content';
        console.log('Updated node:', nodeId);
        // Refresh the mind map view
        await jm.open(mind);
    } else {
        console.error('Node not found:', nodeId);
    }
}`,
            moveNode: `// Move a node to a new parent
// Replace 'node-id-here' and 'new-parent-id' with actual IDs
const nodeId = 'node-id-here';
const newParentId = 'new-parent-id';
if (mind) {
    try {
        mind.moveNode(nodeId, { parentId: newParentId });
        console.log('Moved node:', nodeId, 'to parent:', newParentId);
        // Refresh the mind map view
        await jm.open(mind);
    } catch (error) {
        console.error('Failed to move node:', error);
    }
}`,
            findNode: `// Find a node by ID
// Replace 'node-id-here' with the actual node ID
const nodeId = 'node-id-here';
if (mind) {
    const node = mind.findNodeById(nodeId);
    if (node) {
        console.log('Found node:', {
            id: node.id,
            content: node.content.value,
            parentId: node.parent ? node.parent.id : null,
            childrenCount: node.children.length
        });
    } else {
        console.log('Node not found:', nodeId);
    }
}`
        };

            // ============================================================================
            // Utility Functions
            // ============================================================================
            const Utils = {
                /**
                 * Format value for display (handles objects, arrays, etc.)
                 */
                formatValue: function(value) {
                    if (value === null || value === undefined) {
                        return '-';
                    }
                    if (typeof value === 'object') {
                        try {
                            return JSON.stringify(value);
                        } catch (e) {
                            return String(value);
                        }
                    }
                    return String(value);
                },

                /**
                 * Show visual feedback on copy icon
                 */
                showCopyFeedback: function(iconElement) {
                    if (!iconElement) return;
                    const originalText = iconElement.textContent;
                    iconElement.textContent = 'âœ“';
                    iconElement.style.color = '#48bb78';
                    setTimeout(() => {
                        iconElement.textContent = originalText;
                        iconElement.style.color = '';
                    }, CONFIG.COPY_FEEDBACK_DURATION);
                },

                /**
                 * Copy text to clipboard with fallback
                 */
                copyToClipboard: async function(text, onSuccess) {
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        try {
                            await navigator.clipboard.writeText(text);
                            if (onSuccess) onSuccess();
                        } catch (err) {
                            console.error('Failed to copy:', err);
                            Utils.fallbackCopyToClipboard(text, onSuccess);
                        }
                    } else {
                        Utils.fallbackCopyToClipboard(text, onSuccess);
                    }
                },

                /**
                 * Fallback copy method for older browsers
                 */
                fallbackCopyToClipboard: function(text, onSuccess) {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();

                    try {
                        const successful = document.execCommand('copy');
                        if (successful && onSuccess) {
                            onSuccess();
                        }
                    } catch (err) {
                        console.error('Fallback copy failed:', err);
                    }

                    document.body.removeChild(textArea);
                }
            };

            // ============================================================================
            // Console Output Management
            // ============================================================================
            const ConsoleOutput = {
                container: null,

                init: function() {
                    this.container = document.getElementById('console-output');
                },

                addLine: function(type, ...args) {
                    if (!this.container) return;

                    const timestamp = new Date().toLocaleTimeString();
                    const formattedArgs = args.map(arg => {
                        if (typeof arg === 'object') {
                            try {
                                return JSON.stringify(arg, null, 2);
                            } catch (e) {
                                return String(arg);
                            }
                        }
                        return String(arg);
                    }).join(' ');

                    const line = document.createElement('div');
                    line.className = `console-line ${type}`;
                    line.textContent = `[${timestamp}] ${formattedArgs}`;
                    this.container.appendChild(line);

                    // Auto scroll to bottom
                    this.container.scrollTop = this.container.scrollHeight;

                    // Limit maximum lines
                    if (this.container.children.length > CONFIG.MAX_CONSOLE_LINES) {
                        this.container.removeChild(this.container.firstChild);
                    }
                },

                clear: function() {
                    if (this.container) {
                        this.container.innerHTML = '';
                    }
                }
            };

            // ============================================================================
            // Console Interceptor
            // ============================================================================
            const ConsoleInterceptor = {
                originalConsole: {
                    log: console.log,
                    info: console.info,
                    warn: console.warn,
                    error: console.error
                },

                setup: function() {
                    const consoleMethods = ['log', 'info', 'warn', 'error'];
                    consoleMethods.forEach(method => {
                        const original = this.originalConsole[method];
                        console[method] = function(...args) {
                            original.apply(console, args);
                            ConsoleOutput.addLine(method, ...args);
                        };
                    });
                }
            };

            // ============================================================================
            // Code Executor
            // ============================================================================
            const CodeExecutor = {
                createExecuteContext: function() {
                    return {
                        jsMind: window.jsMind,
                        jm: window.jm,
                        mind: window.mind,
                        console: console,
                        setTimeout,
                        clearTimeout,
                        setInterval,
                        clearInterval,
                        Promise,
                        Date,
                        JSON,
                    };
                },

                execute: async function(code) {
                    try {
                        const executeContext = this.createExecuteContext();
                        const paramNames = Object.keys(executeContext);
                        const paramValues = Object.values(executeContext);

                        // Wrap code in async function to support await
                        const asyncCode = `return (async function() {\n${code}\n})();`;
                        const func = new Function(...paramNames, asyncCode);
                        const result = func(...paramValues);

                        // Ensure result is a Promise and wait for it to complete
                        const promise = result instanceof Promise ? result : Promise.resolve(result);
                        await promise;
                    } catch (error) {
                        // Re-throw to allow caller to handle
                        throw error;
                    }
                }
            };

            // ============================================================================
            // Node Info Bar Management
            // ============================================================================
            const NodeInfoBar = {
                nodeIdElement: null,
                contentValueElement: null,
                copyIconElement: null,

                init: function() {
                    this.nodeIdElement = document.getElementById('node-id-value');
                    this.contentValueElement = document.getElementById('content-value');
                    this.copyIconElement = document.getElementById('copy-node-id-icon');
                },

                update: function(nodeId, contentValue) {
                    // Update node ID
                    if (this.nodeIdElement) {
                        this.nodeIdElement.textContent = nodeId || '-';
                    }

                    // Show/hide copy icon based on whether nodeId exists
                    if (this.copyIconElement) {
                        if (nodeId && nodeId !== '-') {
                            this.copyIconElement.classList.remove('hidden');
                        } else {
                            this.copyIconElement.classList.add('hidden');
                        }
                    }

                    // Update content value
                    if (this.contentValueElement) {
                        this.contentValueElement.textContent = Utils.formatValue(contentValue);
                    }
                },

                clear: function() {
                    this.update(null, null);
                },

                copyNodeId: function() {
                    if (!this.nodeIdElement) return;

                    const nodeId = this.nodeIdElement.textContent;
                    if (!nodeId || nodeId === '-') {
                        return;
                    }

                    Utils.copyToClipboard(nodeId, () => {
                        Utils.showCopyFeedback(this.copyIconElement);
                    });
                }
            };

            // ============================================================================
            // Node Click Listener
            // ============================================================================
            const NodeClickListener = {
                isSetup: false,

                setup: function() {
                    const container = document.getElementById('jsmind_container');
                    if (!container || this.isSetup) return;

                    // Use event delegation to listen for node clicks
                    container.addEventListener('click', (event) => {
                        let target = event.target;
                        let foundNode = false;
                        
                        while (target && target !== container) {
                            // Check if it's a jsmind-node element
                            if (target.classList && target.classList.contains('jsmind-node')) {
                                const nodeId = target.getAttribute('data-jm-node-id');
                                if (nodeId) {
                                    this.handleNodeClick(nodeId);
                                    foundNode = true;
                                    return;
                                }
                            }
                            target = target.parentElement;
                        }
                        
                        // If no node found, clear info bar
                        if (!foundNode) {
                            NodeInfoBar.clear();
                        }
                    });
                    
                    this.isSetup = true;
                    console.log('Node click listener has been set up');
                },

                handleNodeClick: function(nodeId) {
                    console.log('Clicked node:', nodeId);
                    
                    let contentValue = null;
                    if (window.mind) {
                        const node = window.mind.findNodeById(nodeId);
                        if (node) {
                            contentValue = node.content ? node.content.value : null;
                            console.log('Node info:', { nodeId, contentValue });
                        } else {
                            console.warn('Node not found:', nodeId);
                        }
                    } else {
                        console.warn('mind is not defined');
                    }
                    
                    NodeInfoBar.update(nodeId, contentValue);
                },

                reset: function() {
                    this.isSetup = false;
                }
            };

            // ============================================================================
            // Code Editor Management
            // ============================================================================
            const CodeEditor = {
                textarea: null,
                initCodeElement: null,

                init: function() {
                    // Initialize read-only code display area
                    this.initCodeElement = document.getElementById('init-code-editor');
                    const initPre = document.createElement('pre');
                    initPre.textContent = INIT_CODE;
                    initPre.className = 'code-display';
                    this.initCodeElement.appendChild(initPre);

                    // Initialize editable code editor
                    const codeEditorElement = document.getElementById('code-editor');
                    this.textarea = document.createElement('textarea');
                    this.textarea.value = DEFAULT_USER_CODE;
                    this.textarea.className = 'code-textarea';
                    codeEditorElement.appendChild(this.textarea);
                },

                getValue: function() {
                    return this.textarea ? this.textarea.value : '';
                },

                setValue: function(value) {
                    if (this.textarea) {
                        this.textarea.value = value;
                        this.textarea.dispatchEvent(new Event('input', { bubbles: true }));
                        this.textarea.focus();
                    }
                },

                loadTemplate: function(templateName) {
                    if (!CODE_TEMPLATES[templateName]) {
                        console.error('Template not found:', templateName);
                        return;
                    }
                    this.setValue(CODE_TEMPLATES[templateName]);
                }
            };

            // ============================================================================
            // Application Initialization
            // ============================================================================
            const App = {
                /**
                 * Execute user code
                 */
                executeCode: async function() {
                    try {
                        const code = CodeEditor.getValue();
                        await CodeExecutor.execute(code);
                        console.log('Code execution completed');
                    } catch (error) {
                        console.error('Code execution failed:', error);
                        if (error.stack) {
                            console.error('Stack trace:', error.stack);
                        }
                    }
                },

                /**
                 * Reset mind map and re-execute initialization code
                 */
                resetMindMap: async function() {
                    if (window.jm) {
                        window.jm.close();
                        window.jm = null;
                    }
                    window.mind = null;
                    const container = document.getElementById('jsmind_container');
                    container.innerHTML = '';
                    NodeInfoBar.clear();
                    NodeClickListener.reset();
                    
                    await App.executeInitCode();
                },

                /**
                 * Execute initialization code
                 */
                executeInitCode: async function() {
                    if (!window.jsMind) {
                        console.error('jsMind not loaded, cannot execute initialization code');
                        return;
                    }

                    try {
                        await CodeExecutor.execute(INIT_CODE + '\n' + INIT_WINDOW_VARIABLES);
                        console.log('Initialization code execution completed, mind map created');
                        // Wait for DOM rendering to complete before setting up node click listener
                        setTimeout(() => {
                            NodeClickListener.setup();
                        }, CONFIG.NODE_CLICK_LISTENER_DELAY);
                    } catch (error) {
                        console.error('Failed to execute initialization code:', error);
                    }
                },

                /**
                 * Initialize application
                 */
                init: function() {
                    // Initialize components
                    ConsoleOutput.init();
                    ConsoleInterceptor.setup();
                    NodeInfoBar.init();
                    CodeEditor.init();

                    // Setup event handlers using event delegation
                    this.setupEventHandlers();

                    // Wait for jsMind to load, then execute initialization code
                    this.waitForJsMind();
                },

                /**
                 * Setup event handlers using event delegation
                 */
                setupEventHandlers: function() {
                    document.addEventListener('click', (event) => {
                        const target = event.target;
                        const action = target.getAttribute('data-action');
                        const template = target.getAttribute('data-template');

                        if (action === 'clear-console') {
                            event.preventDefault();
                            ConsoleOutput.clear();
                        } else if (action === 'copy-node-id') {
                            event.preventDefault();
                            NodeInfoBar.copyNodeId();
                        } else if (action === 'execute-code') {
                            event.preventDefault();
                            App.executeCode();
                        } else if (action === 'reset-mindmap') {
                            event.preventDefault();
                            App.resetMindMap();
                        } else if (template) {
                            event.preventDefault();
                            CodeEditor.loadTemplate(template);
                        }
                    });
                },

                /**
                 * Wait for jsMind library to load
                 */
                waitForJsMind: function() {
                    function checkAndExecute() {
                        if (window.jsMind) {
                            console.log('jsMind loaded, version:', window.jsMind.Version || 'unknown');
                            App.executeInitCode();
                        } else {
                            setTimeout(checkAndExecute, CONFIG.JSMIND_CHECK_INTERVAL);
                        }
                    }
                    checkAndExecute();
                }
            };

            // ============================================================================
            // Initialize Application
            // ============================================================================
            window.addEventListener('DOMContentLoaded', function() {
                App.init();
            });

            // Expose necessary APIs to window for backward compatibility (if needed)
            window.Playground = {
                executeCode: () => App.executeCode(),
                resetMindMap: () => App.resetMindMap(),
                loadTemplate: (name) => CodeEditor.loadTemplate(name),
                clearConsole: () => ConsoleOutput.clear()
            };
        })();
    </script>
</body>
</html>
